<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>CRE Practice CBT</title>
<style>
  body { font-family: Arial, system-ui, sans-serif; margin: 0; padding: 0; background:#f2f4f7; }
  .container { max-width: 1100px; margin: 20px auto; background:#fff; border-radius:10px; padding:20px 24px 40px; box-shadow:0 4px 12px rgba(0,0,0,0.08); display:none; }
  h1 { margin-top:0; }
  .controls { display:flex; flex-wrap:wrap; gap:12px; margin-bottom:16px; padding:12px; background:#f7f9fc; border-radius:8px; }
  .controls > div { min-width: 180px; }
  label { font-size:14px; font-weight:600; display:block; margin-bottom:4px; }
  select, input[type="number"], input[type="text"], textarea { width:100%; padding:6px 8px; font-size:14px; box-sizing:border-box; }
  button { padding:8px 14px; font-size:14px; cursor:pointer; border-radius:6px; border:1px solid #1f6feb; background:#1f6feb; color:#fff; }
  button.secondary { background:#fff; color:#1f2933; border-color:#cbd2e1; }
  button.danger { background:#e11d48; border-color:#e11d48; color:#fff; }
  button:disabled { opacity:0.6; cursor:not-allowed; }
  #timer { font-size:18px; font-weight:bold; color:#e11d48; }
  #modeDesc { font-size:13px; color:#4b5563; margin-top:4px; }

  .question-block { margin-bottom:20px; padding-bottom:12px; border-bottom:1px solid #e5e7eb; }
  .question-title { font-weight:bold; margin-bottom:8px; }
  .meta { font-size:12px; color:#6b7280; margin-bottom:4px; }
  .option { margin:4px 0; font-size:14px; }
  #resultBox { margin-top:24px; padding:16px; border-radius:8px; background:#ecfeff; border:1px solid #7dd3fc; }
  #resultBox h3 { margin-top:0; }
  .explanation { font-size:13px; margin-top:4px; color:#334155; }

  .panel-row { display:flex; gap:12px; flex-wrap:wrap; margin-top:20px; }
  .panel { flex:1; min-width:260px; background:#f9fafb; border-radius:8px; padding:10px 12px; border:1px solid #e5e7eb; max-height:300px; overflow:auto; }
  .panel h3 { margin-top:0; font-size:15px; }
  .note-item, .score-item { font-size:12px; margin-bottom:6px; border-bottom:1px dashed #e5e7eb; padding-bottom:4px; }

  .tag { display:inline-block; font-size:11px; padding:1px 6px; border-radius:999px; margin-left:4px; background:#e5e7eb; }
  .tag.A { background:#dbeafe; }
  .tag.C { background:#fef3c7; }

  /* ë¹„ë°€ë²ˆí˜¸ ê²Œì´íŠ¸ */
  #gateOverlay {
    position:fixed; inset:0; background:rgba(15,23,42,0.9);
    display:flex; align-items:center; justify-content:center; z-index:9999;
  }
  #gateBox {
    background:#f9fafb; border-radius:12px; padding:24px 26px; width:320px;
    box-shadow:0 10px 30px rgba(0,0,0,0.4);
  }
  #gateBox h2 { margin-top:0; margin-bottom:12px; }
  #gateMessage { font-size:12px; color:#dc2626; height:16px; margin-top:6px; }
  #gateBox input { width:100%; padding:8px; margin-top:8px; box-sizing:border-box; }
  #gateBox button { margin-top:12px; width:100%; }

  /* ë¬¸ì œ ì¶”ê°€ íŒ¨ë„ */
  #addQuestionForm textarea { height:60px; resize:vertical; }
  #addQuestionForm .small-input { width:60px; display:inline-block; }
</style>
</head>
<body>

<!-- ë¹„ë°€ë²ˆí˜¸ ê²Œì´íŠ¸ -->
<div id="gateOverlay">
  <div id="gateBox">
    <h2>CRE ì—°ìŠµ ì‚¬ì´íŠ¸</h2>
    <p style="font-size:13px;color:#4b5563;">
      ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
    </p>
    <input type="password" id="gatePassword" placeholder="ë¹„ë°€ë²ˆí˜¸" />
    <div id="gateMessage"></div>
    <button id="gateBtn">ì…ì¥</button>
    <p style="font-size:11px;color:#6b7280;margin-top:12px;">
      * ì´ ë¹„ë°€ë²ˆí˜¸ëŠ” ê°„ë‹¨í•œ ì¶œì… í†µì œìš©ì…ë‹ˆë‹¤. ë³´ì•ˆìš©ìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </p>
  </div>
</div>

<div class="container" id="appContainer">
  <h1>CRE Practice CBT</h1>
  <p style="font-size:13px;color:#4b5563;">
    ì±•í„° / ìœ í˜• / ë¬¸ì œ ìˆ˜ / ì‹œê°„ / ì¶œì œ ëª¨ë“œ ì„ íƒ í›„ <b>ì‹œí—˜ ì‹œì‘</b>ì„ ëˆŒëŸ¬ ì—°ìŠµí•˜ì„¸ìš”.<br/>
    ì˜¤ë‹µê³¼ ì ìˆ˜ëŠ” ë¸Œë¼ìš°ì €(LocalStorage)ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤.
  </p>

  <div class="controls">
    <div>
      <label>ì±•í„° ì„ íƒ</label>
      <select id="chapterSelect">
        <option value="all">ì „ì²´</option>
        <option value="ì±•í„° 2 - Reliability Fundamentals">ì±•í„° 2 - Reliability Fundamentals</option>
        <option value="ì±•í„° 3 - Risk Management">ì±•í„° 3 - Risk Management</option>
        <option value="ì±•í„° 4 - Statistical Concepts">ì±•í„° 4 - Statistical Concepts</option>
        <option value="ì±•í„° 5 - Data Management">ì±•í„° 5 - Data Management</option>
        <option value="ì±•í„° 6 - Reliability Planning">ì±•í„° 6 - Reliability Planning</option>
        <option value="ì±•í„° 7 - Testing and Modeling">ì±•í„° 7 - Testing and Modeling</option>
        <option value="ì±•í„° 8 - Reliability Designs">ì±•í„° 8 - Reliability Designs</option>
        <option value="ì±•í„° 9 - Maintainability">ì±•í„° 9 - Maintainability</option>
      </select>
    </div>
    <div>
      <label>ë¬¸ì œ ìœ í˜•</label>
      <select id="typeSelect">
        <option value="all">A+C ì „ì²´</option>
        <option value="A">A-type (ê°œë…í˜•)</option>
        <option value="C">C-type (ê³„ì‚°/ìƒí™©í˜•)</option>
      </select>
    </div>
    <div>
      <label>ì¶œì œ ë¬¸ì œ ìˆ˜</label>
      <input id="countInput" type="number" min="1" max="200" value="10" />
    </div>
    <div>
      <label>íƒ€ì´ë¨¸ (ë¶„)</label>
      <input id="timerInput" type="number" min="0" max="240" value="60" />
    </div>
    <div>
      <label>ì¶œì œ ëª¨ë“œ</label>
      <select id="modeSelect">
        <option value="normal">ì¼ë°˜ ëª¨ë“œ</option>
        <option value="wrong">ì˜¤ë‹µë§Œ ëª¨ë“œ</option>
        <option value="weak">ì•½ì  ì±•í„° ëª¨ë“œ</option>
      </select>
    </div>
    <div style="display:flex;align-items:flex-end;gap:8px;">
      <button id="startBtn">ì‹œí—˜ ì‹œì‘</button>
      <button id="submitBtn" class="secondary" disabled>ì œì¶œ</button>
      <button id="resetBtn" class="secondary" disabled>ì´ˆê¸°í™”</button>
    </div>
    <div style="margin-left:auto; text-align:right;">
      <div id="timer">Timer: OFF</div>
      <div id="modeDesc"></div>
    </div>
  </div>

  <div id="quizBox"></div>
  <div id="resultBox"></div>

  <div class="panel-row">
    <div class="panel">
      <h3>ğŸ“’ ì˜¤ë‹µë…¸íŠ¸ (ìë™ ì €ì¥)</h3>
      <div id="wrongNotesBox"></div>
      <button class="secondary" onclick="clearWrongNotes()">ì˜¤ë‹µë…¸íŠ¸ ì´ˆê¸°í™”</button>
    </div>
    <div class="panel">
      <h3>ğŸ“Š ì ìˆ˜ ê¸°ë¡ (LocalStorage)</h3>
      <div id="scoreHistoryBox"></div>
      <button class="secondary" onclick="clearScoreHistory()">ì ìˆ˜ ê¸°ë¡ ì´ˆê¸°í™”</button>
    </div>
    <div class="panel">
      <h3>â• ë¬¸ì œ ì¶”ê°€ (ì´ ë¸Œë¼ìš°ì €ì— ì €ì¥)</h3>
      <form id="addQuestionForm">
        <label>ë¬¸ì œ ID (ì˜ˆ: Q100-1)</label>
        <input type="text" id="addId" placeholder="Q100-1" required />
        <label>ì±•í„°</label>
        <select id="addChapter">
          <option value="ì±•í„° 2 - Reliability Fundamentals">ì±•í„° 2 - Reliability Fundamentals</option>
          <option value="ì±•í„° 3 - Risk Management">ì±•í„° 3 - Risk Management</option>
          <option value="ì±•í„° 4 - Statistical Concepts">ì±•í„° 4 - Statistical Concepts</option>
          <option value="ì±•í„° 5 - Data Management">ì±•í„° 5 - Data Management</option>
          <option value="ì±•í„° 6 - Reliability Planning">ì±•í„° 6 - Reliability Planning</option>
          <option value="ì±•í„° 7 - Testing and Modeling">ì±•í„° 7 - Testing and Modeling</option>
          <option value="ì±•í„° 8 - Reliability Designs">ì±•í„° 8 - Reliability Designs</option>
          <option value="ì±•í„° 9 - Maintainability">ì±•í„° 9 - Maintainability</option>
        </select>
        <label>ìœ í˜•</label>
        <select id="addType">
          <option value="A">A-type (ê°œë…í˜•)</option>
          <option value="C">C-type (ê³„ì‚°/ìƒí™©í˜•)</option>
        </select>
        <label>ë¬¸ì œ ë‚´ìš©</label>
        <textarea id="addText" required></textarea>
        <label>ë³´ê¸° A / B / C / D</label>
        <input type="text" id="addOpA" placeholder="ë³´ê¸° A" required />
        <input type="text" id="addOpB" placeholder="ë³´ê¸° B" required />
        <input type="text" id="addOpC" placeholder="ë³´ê¸° C" required />
        <input type="text" id="addOpD" placeholder="ë³´ê¸° D" required />
        <label>ì •ë‹µ (0=A, 1=B, 2=C, 3=D)</label>
        <input type="number" id="addAnswer" class="small-input" min="0" max="3" value="0" required />
        <label>í•´ì„¤</label>
        <textarea id="addExplanation" placeholder="ê°„ë‹¨í•œ í•´ì„¤" required></textarea>
        <button type="submit" class="secondary" style="margin-top:8px;">ë¬¸ì œ ì¶”ê°€</button>
      </form>

      <hr style="margin:10px 0;">
      <h4 style="font-size:13px;">ğŸ“ ë¬¸ì œ íŒŒì¼ ì—…ë¡œë“œ (JSON)</h4>
      <input type="file" id="uploadFileInput" accept=".json" />
      <button type="button" class="secondary" id="uploadFileBtn" style="margin-top:6px;">íŒŒì¼ì—ì„œ ë¬¸ì œ ì¶”ê°€</button>
      <p style="font-size:11px;color:#6b7280;margin-top:4px;">
        - í˜•ì‹: JSON ë°°ì—´, ê° í•­ëª©ì€ {id, chapter, type, text, options[4], answer, explanation}<br/>
        - ì˜ˆ: <code>cre_questions_xxx.json</code> íŒŒì¼ ì—…ë¡œë“œ â†’ ì—¬ëŸ¬ ë¬¸ì œ í•œ ë²ˆì— ì¶”ê°€
      </p>

      <hr style="margin:10px 0;">
      <h4 style="font-size:13px;">ğŸ“¦ ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œ ê´€ë¦¬</h4>
      <button type="button" class="danger" id="clearCustomBtn" style="margin-top:4px;">ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œ ëª¨ë‘ ì‚­ì œ</button>
      <button type="button" class="secondary" id="exportCustomBtn" style="margin-top:4px;">í˜„ì¬ ì¶”ê°€ ë¬¸ì œ JSON ë‹¤ìš´ë¡œë“œ</button>
      <p style="font-size:11px;color:#6b7280;margin-top:4px;">
        - ë‹¤ìš´ë¡œë“œí•œ JSONì„ ë‹¤ë¥¸ PCì—ì„œ ì´ ì‚¬ì´íŠ¸ ì—´ê³ <br/>
        &nbsp;&nbsp;ìœ„ì˜ â€œíŒŒì¼ì—ì„œ ë¬¸ì œ ì¶”ê°€â€ë¡œ ì—…ë¡œë“œí•˜ë©´ ë¬¸ì œì€í–‰ ë³µì› ê°€ëŠ¥<br/>
        - ì‚­ì œ ë²„íŠ¼ì€ <b>ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œë§Œ</b> ì§€ìš°ê³ , ê¸°ë³¸ ë¬¸ì œÂ·ì˜¤ë‹µÂ·ì ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
      </p>

      <p style="font-size:11px;color:#6b7280;margin-top:6px;">
        * ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œëŠ” ì´ ë¸Œë¼ìš°ì €(LocalStorage)ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.<br/>
        (ë‹¤ë¥¸ PC/ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë³´ì´ì§€ ì•ŠìŒ)
      </p>
    </div>
  </div>
</div>

<script>
// ========================
//  0. ì„¤ì •: ë¹„ë°€ë²ˆí˜¸
// ========================
const APP_PASSWORD = "cre2025"; // ì—¬ê¸°ì„œ ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë°”ê¿”ë„ ë¨

// ========================
//  1. ê¸°ë³¸ ë¬¸ì œ ë°ì´í„° (ì±•í„°ëª… ë°˜ì˜)
// ========================
const BASE_QUESTIONS = [
  // ì±•í„° 4 - Statistical Concepts (ì˜› Stats)
  {
    id: "Q1",
    chapter: "ì±•í„° 4 - Statistical Concepts",
    type: "C",
    text: "Exponential ë¶„í¬ì—ì„œ MTBF = 800ì‹œê°„ì¼ ë•Œ, 400ì‹œê°„ì˜ ì‹ ë¢°ë„ R(400)ì— ê°€ì¥ ê°€ê¹Œìš´ ê°’ì€?",
    options: ["0.50","0.61","0.37","0.80"],
    answer: 1,
    explanation: "R(t) = exp(-t/MTBF) = exp(-400/800) = exp(-0.5) â‰ˆ 0.6065 â†’ 0.61",
  },
  {
    id: "Q2",
    chapter: "ì±•í„° 4 - Statistical Concepts",
    type: "C",
    text: "Exponential ìˆ˜ëª…ì‹œí—˜ì—ì„œ ì´ ì‹œí—˜ì‹œê°„ T = 4000h, ê³ ì¥ìˆ˜ r = 3ì¼ ë•Œ, 90% í•˜í•œ MTBFë¥¼ êµ¬í•˜ëŠ” ì˜¬ë°”ë¥¸ ì‹ì€?",
    options: [
      "2T / Ï‡Â²(2r; lower 0.10)",
      "2T / Ï‡Â²(2r; upper 0.10)",
      "T / r",
      "T / (r-1)"
    ],
    answer: 1,
    explanation: "Lower one-sided LCB = 2T / Ï‡Â²(2r; upper Î±). ì—¬ê¸°ì„œ Î±=0.10.",
  },
  {
    id: "Q3",
    chapter: "ì±•í„° 4 - Statistical Concepts",
    type: "C",
    text: "ì •ê·œë¶„í¬(Î¼=50, Ïƒ=10)ë¥¼ ë”°ë¥¼ ë•Œ, 40ì‹œê°„ ë‚´ ê³ ì¥ë‚  í™•ë¥ ì— ê°€ì¥ ê°€ê¹Œìš´ ê°’ì€?",
    options: [
      "ì•½ 0.16",
      "ì•½ 0.30",
      "ì•½ 0.50",
      "ì•½ 0.84"
    ],
    answer: 0,
    explanation: "Z=(40-50)/10=-1 â†’ P(Xâ‰¤40)=Î¦(-1)â‰ˆ0.1587 â†’ ì•½ 0.16",
  },
  {
    id: "Q4",
    chapter: "ì±•í„° 4 - Statistical Concepts",
    type: "A",
    text: "Exponential ë¶„í¬ì—ì„œ MTBF ì‹œì ì—ì„œì˜ ì‹ ë¢°ë„ R(MTBF)ì— ê°€ì¥ ê°€ê¹Œìš´ ê°’ì€?",
    options: ["0.50","0.37","0.63","0.90"],
    answer: 1,
    explanation: "R(MTBF)=exp(-1)â‰ˆ0.3679 â†’ ì•½ 0.37",
  },
  {
    id: "Q5",
    chapter: "ì±•í„° 4 - Statistical Concepts",
    type: "A",
    text: "Weibull ë¶„í¬ì—ì„œ Î²(í˜•ìƒëª¨ìˆ˜)ê°€ 1ë³´ë‹¤ í´ ë•Œ ì˜ë¯¸ëŠ”?",
    options: [
      "ì´ˆê¸° ê³ ì¥ ì˜ì—­",
      "ë§ˆëª¨ ê³ ì¥ ì˜ì—­, ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê³ ì¥ë¥  ì¦ê°€",
      "ê³ ì¥ë¥  ì¼ì •",
      "ë¬´ì‘ìœ„ ê³ ì¥ ì˜ì—­"
    ],
    answer: 1,
    explanation: "Î²>1 â†’ ê³ ì¥ë¥ ì´ ì¦ê°€í•˜ëŠ” ë§ˆëª¨(wear-out) ì˜ì—­.",
  },

  // ì±•í„° 7 - Testing and Modeling (ì˜› Testing)
  {
    id: "Q6",
    chapter: "ì±•í„° 7 - Testing and Modeling",
    type: "A",
    text: "ALT(Accelerated Life Testing)ì˜ ê°€ì¥ í•µì‹¬ ëª©ì ì€?",
    options: [
      "ì„¤ê³„ í•œê³„ í•˜ì¤‘ì„ ì°¾ê¸° ìœ„í•´",
      "ë‹¨ê¸°ê°„ ì‹œí—˜ìœ¼ë¡œ ì •ìƒì‚¬ìš© ì¡°ê±´ì—ì„œì˜ ìˆ˜ëª…ì„ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´",
      "ê³µì •ëŠ¥ë ¥(Cpk)ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´",
      "íŒŒê´´ ì‹œí—˜ìœ¼ë¡œ ê³ ì¥ ëª¨ë“œë¥¼ ì œê±°í•˜ê¸° ìœ„í•´"
    ],
    answer: 1,
    explanation: "ALTëŠ” ì§§ì€ ì‹œê°„ì— ë°ì´í„°ë¥¼ ëª¨ì•„ ì •ìƒ ì‚¬ìš©ì¡°ê±´ ìˆ˜ëª…ì„ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì´ í•µì‹¬.",
  },
  {
    id: "Q7",
    chapter: "ì±•í„° 7 - Testing and Modeling",
    type: "A",
    text: "Peck ëª¨ë¸ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?",
    options: [
      "ì˜¨ë„ë§Œ ê³ ë ¤í•˜ëŠ” ê°€ì† ëª¨ë¸ì´ë‹¤.",
      "ìŠµë„ë§Œ ê³ ë ¤í•˜ëŠ” ê°€ì† ëª¨ë¸ì´ë‹¤.",
      "ì˜¨ë„ì™€ ìƒëŒ€ìŠµë„ë¥¼ ëª¨ë‘ ê³ ë ¤í•˜ëŠ” ê°€ì† ëª¨ë¸ì´ë‹¤.",
      "ì „ì••ê³¼ ì§„ë™ì„ ë™ì‹œì— ê³ ë ¤í•˜ëŠ” ëª¨ë¸ì´ë‹¤."
    ],
    answer: 2,
    explanation: "Peck: ì˜¨ë„ + ìŠµë„ ê¸°ë°˜ ê°€ì† ëª¨ë¸.",
  },
  {
    id: "Q8",
    chapter: "ì±•í„° 7 - Testing and Modeling",
    type: "A",
    text: "Step-stress ì‹œí—˜ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ê°€ì¥ ì˜¬ë°”ë¥¸ ê²ƒì€?",
    options: [
      "ì‹œê°„ì— ë”°ë¼ ì¼ì •í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ìœ ì§€í•˜ëŠ” ì‹œí—˜ì´ë‹¤.",
      "ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì„ ë‹¨ê³„ì ìœ¼ë¡œ ì¦ê°€ì‹œí‚¤ëŠ” ì‹œí—˜ì´ë‹¤.",
      "ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì„ ë‹¨ê³„ì ìœ¼ë¡œ ê°ì†Œì‹œí‚¤ëŠ” ì‹œí—˜ì´ë‹¤.",
      "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë¬´ì‘ìœ„ë¡œ ë³€í™”ì‹œí‚¤ëŠ” ì‹œí—˜ì´ë‹¤."
    ],
    answer: 1,
    explanation: "Step-stress: íŠ¹ì • ì‹œê°„ ê°„ê²©ë§ˆë‹¤ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì„ ì˜¬ë ¤ê°€ëŠ” ì‹œí—˜.",
  },
  {
    id: "Q9",
    chapter: "ì±•í„° 7 - Testing and Modeling",
    type: "C",
    text: "ì‹ ë¢°ë„ 0.7, 0.8, 0.9ì¸ ì„¸ ì„œë¸Œì‹œìŠ¤í…œì´ ë³‘ë ¬ êµ¬ì„±ì¼ ë•Œ ì‹œìŠ¤í…œ ì‹ ë¢°ë„ì— ê°€ì¥ ê°€ê¹Œìš´ ê°’ì€?",
    options: ["0.90","0.97","0.50","0.80"],
    answer: 1,
    explanation: "R=1-(1-.7)(1-.8)(1-.9)=1-(0.3*0.2*0.1)=1-0.006=0.994(ë¬¸ì œ ë³´ê¸° ì¤‘ ê°€ì¥ ê·¼ì ‘ê°’ ì„ íƒ).",
  },
  {
    id: "Q10",
    chapter: "ì±•í„° 7 - Testing and Modeling",
    type: "C",
    text: "Perfect switching standby ì‹œìŠ¤í…œì—ì„œ Active ìœ ë‹› ì‹ ë¢°ë„=0.9, Standby=0.8ì¼ ë•Œ ì‹œìŠ¤í…œ ì‹ ë¢°ë„ëŠ”?",
    options: ["0.90","0.92","0.98","0.99"],
    answer: 2,
    explanation: "Rsys = Ra + (1-Ra)Rs = 0.9 + 0.1*0.8 = 0.98",
  },

  // ì±•í„° 3 - Risk Management (ì˜› Risk)
  {
    id: "Q11",
    chapter: "ì±•í„° 3 - Risk Management",
    type: "A",
    text: "ê³µí†µì›ì¸ê³ ì¥(Common Cause Failure)ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜¬ë°”ë¥¸ ê²ƒì€?",
    options: [
      "ë…ë¦½ì ì¸ ì›ì¸ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ë‹¤ìˆ˜ì˜ ê³ ì¥",
      "ì¤‘ë³µ ì‹œìŠ¤í…œì˜ ì—¬ëŸ¬ ê²½ë¡œê°€ ë™ì¼í•œ ì›ì¸ìœ¼ë¡œ ë™ì‹œì— ê³ ì¥ë‚˜ëŠ” í˜„ìƒ",
      "í™˜ê²½ê³¼ ë¬´ê´€í•œ ëœë¤ ê³ ì¥",
      "í•œ ë¶€í’ˆì´ ê³ ì¥ë‚œ ë’¤ ìˆ˜ë¦¬ë˜ëŠ” ê³¼ì •"
    ],
    answer: 1,
    explanation: "CCF: í•œ ì›ì¸ì´ ì—¬ëŸ¬ ê²½ë¡œë¥¼ ë™ì‹œì— ì£½ì´ëŠ” í˜•íƒœ.",
  },
  {
    id: "Q12",
    chapter: "ì±•í„° 3 - Risk Management",
    type: "A",
    text: "FTA(Fault Tree Analysis)ì˜ ëŒ€í‘œì ì¸ ì¥ì ì€?",
    options: [
      "ëª¨ë“  ê³ ì¥ ëª¨ë“œë¥¼ ë™ì‹œì— ë¶„ì„í•  ìˆ˜ ìˆë‹¤.",
      "ì‹œê°„ì— ë”°ë¥¸ ê³ ì¥ë¥  ì¶”ì„¸ë¥¼ ë¶„ì„í•œë‹¤.",
      "í•˜ë‚˜ì˜ íŠ¹ì • Top eventì— ì§‘ì¤‘í•´ ì›ì¸ì„ ë¶„ì„í•  ìˆ˜ ìˆë‹¤.",
      "ì„¤ê³„ ë³€ìˆ˜ ê°„ í†µê³„ì  ìƒí˜¸ì‘ìš©ì„ ë¶„ì„í•œë‹¤."
    ],
    answer: 2,
    explanation: "FTAëŠ” Top event(ì‹œìŠ¤í…œ ê³ ì¥)ë¥¼ ì •í•´ë†“ê³  ê·¸ ì›ì¸ì„ ë…¼ë¦¬ì ìœ¼ë¡œ ì¶”ì .",
  },

  // ì±•í„° 8 - Reliability Designs (ì˜› Design)
  {
    id: "Q13",
    chapter: "ì±•í„° 8 - Reliability Designs",
    type: "A",
    text: "DOEì—ì„œ 'ë¸”ë¡(block)'ì˜ ì˜¬ë°”ë¥¸ ì •ì˜ëŠ”?",
    options: [
      "ìš”ì¸ì˜ ìˆ˜ì¤€(level)ì„ ì˜ë¯¸í•œë‹¤.",
      "ì„œë¡œ ë‹¤ë¥¸ ì²˜ë¦¬ë¥¼ ë¹„êµì  ê· ì§ˆí•œ ë‹¨ìœ„ë¡œ ë¬¶ì€ ì§‘ë‹¨.",
      "ë°˜ë³µ(run)ê³¼ ê°™ì€ ê°œë…ì´ë‹¤.",
      "ìƒí˜¸ì‘ìš© íš¨ê³¼ë¥¼ ì˜ë¯¸í•œë‹¤."
    ],
    answer: 1,
    explanation: "ë¸”ë¡: ê· ì§ˆí•œ ì¡°ê±´ ê·¸ë£¹ìœ¼ë¡œ, ì²˜ë¦¬ ê°„ ë¹„êµë¥¼ ê³µì •í•˜ê²Œ í•˜ê¸° ìœ„í•¨.",
  },
  {
    id: "Q14",
    chapter: "ì±•í„° 8 - Reliability Designs",
    type: "A",
    text: "Taguchi Loss Functionì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ê°€ì¥ ì˜¬ë°”ë¥¸ ê²ƒì€?",
    options: [
      "ê·œê²© ë‚´ì— ìˆìœ¼ë©´ ì†ì‹¤ì€ 0ì´ë‹¤.",
      "í’ˆì§ˆ íŠ¹ì„±ì´ ëª©í‘œê°’ì—ì„œ ë²—ì–´ë‚ ìˆ˜ë¡ ì†ì‹¤ì´ ì œê³±ì— ë¹„ë¡€í•´ ì¦ê°€í•œë‹¤.",
      "ì†ì‹¤ì€ í•­ìƒ ì„ í˜•ì ìœ¼ë¡œ ì¦ê°€í•œë‹¤.",
      "ì†ì‹¤ì€ ì¼ì • ìƒìˆ˜ì´ë‹¤."
    ],
    answer: 1,
    explanation: "L = k(y-T)^2 í˜•íƒœ â†’ ì œê³±ì— ë¹„ë¡€.",
  },
  {
    id: "Q15",
    chapter: "ì±•í„° 8 - Reliability Designs",
    type: "A",
    text: "ê°•ê±´ì„¤ê³„(Robust Design)ì˜ í•µì‹¬ ëª©ì ì€?",
    options: [
      "ì„¤ê³„ ë¹„ìš© ìµœì†Œí™”",
      "ê³µì •ëŠ¥ë ¥(Cpk) ìµœëŒ€í™”",
      "ì¡ìŒì¸ìì— ëŒ€í•œ ë¯¼ê°ë„ ê°ì†Œë¡œ ì„±ëŠ¥ ë³€ë™ ìµœì†Œí™”",
      "ì‹œí—˜ ì‹œê°„ ë‹¨ì¶•"
    ],
    answer: 2,
    explanation: "Robust Design = Noiseì— ëœ ë¯¼ê°í•œ ì„¤ê³„.",
  },

  // ì±•í„° 9 - Maintainability (ì˜› Maintain)
  {
    id: "Q16",
    chapter: "ì±•í„° 9 - Maintainability",
    type: "A",
    text: "RCM(Reliability-Centered Maintenance)ì˜ ê°€ì¥ ê·¼ë³¸ì ì¸ ëª©ì ì€?",
    options: [
      "ì „ì²´ ìœ ì§€ë³´ìˆ˜ ë¹„ìš©ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ì„œ",
      "ì‹œìŠ¤í…œì˜ ì‹ ë¢°ì„±ê³¼ ê°€ìš©ì„±ì„ ì¶”ì •í•˜ê¸° ìœ„í•´ì„œ",
      "ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ê³ ì¥ ëª¨ë“œì— ëŒ€í•´ ì ì ˆí•œ ì˜ˆë°© ë³´ì „ ì „ëµì„ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ",
      "ëª¨ë“  ë¶€í’ˆì„ ë™ì¼ ì£¼ê¸°ë¡œ êµì²´í•˜ê¸° ìœ„í•´ì„œ"
    ],
    answer: 2,
    explanation: "RCM = ì¤‘ìš” ê³ ì¥ ëª¨ë“œì— ëŒ€í•œ ìµœì  ì˜ˆë°©ë³´ì „ ì •ì˜ê°€ ëª©ì .",
  },
  {
    id: "Q17",
    chapter: "ì±•í„° 9 - Maintainability",
    type: "C",
    text: "ì–´ë–¤ ì‹œìŠ¤í…œì˜ MTBM=1700h, MDT=34hì¼ ë•Œ Operational Availability Aoì— ê°€ì¥ ê°€ê¹Œìš´ ê°’ì€?",
    options: ["0.90","0.95","0.98","0.99"],
    answer: 2,
    explanation: "Ao = 1700/(1700+34) â‰ˆ 1700/1734 â‰ˆ 0.981",
  },
];

// ========================
//  2. LocalStorage í—¬í¼
// ========================
function loadWrongNotes() {
  try { return JSON.parse(localStorage.getItem("creWrongNotes") || "[]"); }
  catch { return []; }
}
function saveWrongNotes(notes) {
  localStorage.setItem("creWrongNotes", JSON.stringify(notes));
}
function loadScoreHistory() {
  try { return JSON.parse(localStorage.getItem("creScoreHistory") || "[]"); }
  catch { return []; }
}
function saveScoreHistory(hist) {
  localStorage.setItem("creScoreHistory", JSON.stringify(hist));
}
function loadCustomQuestions() {
  try { return JSON.parse(localStorage.getItem("creCustomQuestions") || "[]"); }
  catch { return []; }
}
function saveCustomQuestions(list) {
  localStorage.setItem("creCustomQuestions", JSON.stringify(list));
}

// BASE + ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œ í•©ì¹˜ê¸°
function getAllQuestions() {
  const custom = loadCustomQuestions();
  return BASE_QUESTIONS.concat(custom);
}

// ========================
//  3. ì˜¤ë‹µë…¸íŠ¸ / ì ìˆ˜ ê¸°ë¡ í‘œì‹œ
// ========================
function renderWrongNotes() {
  const box = document.getElementById("wrongNotesBox");
  const notes = loadWrongNotes();
  if (!notes.length) {
    box.innerHTML = "<div style='font-size:12px;color:#6b7280;'>ì €ì¥ëœ ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</div>";
    return;
  }
  box.innerHTML = notes.map(n => `
    <div class="note-item">
      <b>${n.id}</b> <span class="tag ${n.type}">${n.type}</span>
      <div style="margin-top:2px;">${n.text}</div>
      <div style="font-size:11px;color:#6b7280;">
        ì±•í„°: ${n.chapter} / í‹€ë¦° íšŸìˆ˜: ${n.missCount} / ë§ˆì§€ë§‰: ${n.lastDate}
      </div>
    </div>
  `).join("");
}
function renderScoreHistory() {
  const box = document.getElementById("scoreHistoryBox");
  const hist = loadScoreHistory();
  if (!hist.length) {
    box.innerHTML = "<div style='font-size:12px;color:#6b7280;'>ì €ì¥ëœ ì ìˆ˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
    return;
  }
  box.innerHTML = hist.slice().reverse().map(h => `
    <div class="score-item">
      <b>${h.date}</b> - ì ìˆ˜ ${h.correct}/${h.total} (${Math.round(h.correct/h.total*100)}%)
      <div style="font-size:11px;color:#6b7280;">
        ëª¨ë“œ: ${h.mode} / ì†Œìš”: ${h.durationSec}s
      </div>
    </div>
  `).join("");
}
function clearWrongNotes() {
  if (!confirm("ì˜¤ë‹µë…¸íŠ¸ë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?")) return;
  saveWrongNotes([]);
  renderWrongNotes();
}
function clearScoreHistory() {
  if (!confirm("ì ìˆ˜ ê¸°ë¡ì„ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?")) return;
  saveScoreHistory([]);
  renderScoreHistory();
}

// ========================
//  4. íƒ€ì´ë¨¸
// ========================
let timerId = null;
let timerSeconds = 0;
let quizStarted = false;
let quizStartTime = null;
let currentQuiz = [];

function updateTimerDisplay() {
  const el = document.getElementById("timer");
  if (!timerSeconds || timerSeconds < 0) {
    el.textContent = "Timer: OFF";
    return;
  }
  const m = String(Math.floor(timerSeconds / 60)).padStart(2,"0");
  const s = String(timerSeconds % 60).padStart(2,"0");
  el.textContent = `ë‚¨ì€ ì‹œê°„: ${m}:${s}`;
}
function startTimer(seconds) {
  clearInterval(timerId);
  timerSeconds = seconds;
  updateTimerDisplay();
  if (seconds <= 0) return;
  timerId = setInterval(() => {
    timerSeconds--;
    updateTimerDisplay();
    if (timerSeconds <= 0) {
      clearInterval(timerId);
      alert("ì‹œê°„ ì¢…ë£Œ! ìë™ ì œì¶œí•©ë‹ˆë‹¤.");
      submitQuiz(true);
    }
  }, 1000);
}
function stopTimer() {
  clearInterval(timerId);
}

// ========================
//  5. ìœ í‹¸: ì„ê¸°
// ========================
function shuffleArray(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// ========================
//  6. í€´ì¦ˆ ë Œë”ë§
// ========================
function renderQuiz() {
  const box = document.getElementById("quizBox");
  box.innerHTML = "";
  currentQuiz.forEach((q, idx) => {
    let html = `<div class="question-block">
      <div class="question-title">Q${idx+1}. ${q.text}</div>
      <div class="meta">
        ID: ${q.id} Â· ì±•í„°: ${q.chapter} Â· ìœ í˜•: ${q.type}
      </div>
    `;
    q.options.forEach((op, j) => {
      html += `
        <div class="option">
          <label>
            <input type="radio" name="q${idx}" value="${j}" />
            ${String.fromCharCode(65+j)}. ${op}
          </label>
        </div>
      `;
    });
    html += "</div>";
    box.innerHTML += html;
  });
}

// ========================
//  7. ì¶œì œ ëª¨ë“œë³„ í’€(pool) ë§Œë“¤ê¸°
// ========================
function buildQuestionPool() {
  const chapter = document.getElementById("chapterSelect").value;
  const qType   = document.getElementById("typeSelect").value;
  const mode    = document.getElementById("modeSelect").value;

  const all = getAllQuestions();
  const notes = loadWrongNotes();

  let pool = [];

  if (mode === "normal") {
    pool = all.filter(q => {
      const chMatch = (chapter === "all" || q.chapter === chapter);
      const typeMatch = (qType === "all" || q.type === qType);
      return chMatch && typeMatch;
    });
  } else if (mode === "wrong") {
    const wrongIds = notes.map(n => n.id);
    pool = all.filter(q => {
      const inWrong = wrongIds.includes(q.id);
      const chMatch = (chapter === "all" || q.chapter === chapter);
      const typeMatch = (qType === "all" || q.type === qType);
      return inWrong && chMatch && typeMatch;
    });
  } else if (mode === "weak") {
    if (!notes.length) {
      alert("ì˜¤ë‹µë…¸íŠ¸ê°€ ë¹„ì–´ ìˆì–´ ì•½ì  ì±•í„°ë¥¼ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ëª‡ íšŒ ì—°ìŠµ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
      return { pool: [], autoChapter: null };
    }
    const counts = {};
    notes.forEach(n => {
      counts[n.chapter] = (counts[n.chapter] || 0) + n.missCount;
    });
    let weakChapter = null;
    let maxCount = -1;
    Object.keys(counts).forEach(ch => {
      if (counts[ch] > maxCount) {
        maxCount = counts[ch];
        weakChapter = ch;
      }
    });
    const typeFilter = qType;
    pool = all.filter(q => {
      const chMatch = (q.chapter === weakChapter);
      const typeMatch = (typeFilter === "all" || q.type === typeFilter);
      return chMatch && typeMatch;
    });
    return { pool, autoChapter: weakChapter };
  }

  return { pool, autoChapter: null };
}

// ========================
//  8. í€´ì¦ˆ ì‹œì‘
// ========================
function startQuiz() {
  const count   = Number(document.getElementById("countInput").value || "0");
  const timerMin= Number(document.getElementById("timerInput").value || "0");
  const mode    = document.getElementById("modeSelect").value;

  const { pool, autoChapter } = buildQuestionPool();
  if (!pool || !pool.length) {
    alert("ì„ íƒí•œ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const shuffled = shuffleArray(pool);
  currentQuiz = shuffled.slice(0, Math.min(count || pool.length, pool.length));

  renderQuiz();
  document.getElementById("resultBox").innerHTML = "";
  quizStarted = true;
  quizStartTime = Date.now();

  document.getElementById("startBtn").disabled = true;
  document.getElementById("submitBtn").disabled = false;
  document.getElementById("resetBtn").disabled = false;

  const chapter = document.getElementById("chapterSelect").value;
  const qType   = document.getElementById("typeSelect").value;

  const modeDesc = [];
  if (mode === "normal") modeDesc.push("ì¼ë°˜");
  if (mode === "wrong")  modeDesc.push("ì˜¤ë‹µë§Œ");
  if (mode === "weak")   modeDesc.push("ì•½ì  ì±•í„°");

  if (mode !== "weak") {
    modeDesc.push(chapter === "all" ? "ì „ì²´ ì±•í„°" : `ì±•í„°=${chapter}`);
  } else if (autoChapter) {
    modeDesc.push(`ì•½ì  ì±•í„°=${autoChapter}`);
  }
  modeDesc.push(qType === "all" ? "A+C" : `ìœ í˜•=${qType}`);
  modeDesc.push(`ë¬¸ì œìˆ˜=${currentQuiz.length}`);
  document.getElementById("modeDesc").textContent = modeDesc.join(" / ");

  startTimer(timerMin > 0 ? timerMin * 60 : 0);
}

// ========================
//  9. ì œì¶œ ë° ì±„ì 
// ========================
function submitQuiz(auto=false) {
  if (!quizStarted) return;
  quizStarted = false;
  stopTimer();

  const durationSec = Math.round((Date.now() - quizStartTime) / 1000);

  let correct = 0;
  let resultHtml = "";
  const wrongToAdd = [];

  currentQuiz.forEach((q, idx) => {
    const selected = document.querySelector(`input[name="q${idx}"]:checked`);
    const userIdx = selected ? Number(selected.value) : null;
    const isCorrect = userIdx === q.answer;
    if (isCorrect) correct++;

    const userText = (userIdx === null) ? "ë¬´ì‘ë‹µ" : `${String.fromCharCode(65+userIdx)}. ${q.options[userIdx]}`;
    const correctText = `${String.fromCharCode(65+q.answer)}. ${q.options[q.answer]}`;

    resultHtml += `
      <div style="margin-bottom:12px;">
        <b>Q${idx+1} (${q.id})</b><br/>
        ë‹¹ì‹ ì˜ ë‹µ: ${userText}<br/>
        ì •ë‹µ: <span style="color:${isCorrect ? '#16a34a' : '#dc2626'}">${correctText}</span>
        <div class="explanation">${q.explanation}</div>
      </div>
    `;

    if (!isCorrect) wrongToAdd.push(q);
  });

  const scorePct = Math.round((correct / currentQuiz.length) * 100);
  document.getElementById("resultBox").innerHTML = `
    <h3>ì ìˆ˜: ${correct} / ${currentQuiz.length} (${scorePct}%)</h3>
    <div style="font-size:12px;color:#6b7280;">ì†Œìš” ì‹œê°„: ${durationSec}ì´ˆ ${auto ? "(íƒ€ì„ì•„ì›ƒ ìë™ ì œì¶œ)" : ""}</div>
    ${resultHtml}
  `;

  document.getElementById("submitBtn").disabled = true;

  // ì˜¤ë‹µë…¸íŠ¸ ì—…ë°ì´íŠ¸
  if (wrongToAdd.length) {
    const notes = loadWrongNotes();
    const nowStr = new Date().toLocaleString();
    wrongToAdd.forEach(q => {
      const existing = notes.find(n => n.id === q.id);
      if (existing) {
        existing.missCount += 1;
        existing.lastDate = nowStr;
      } else {
        notes.push({
          id: q.id,
          text: q.text,
          chapter: q.chapter,
          type: q.type,
          missCount: 1,
          lastDate: nowStr
        });
      }
    });
    saveWrongNotes(notes);
    renderWrongNotes();
  }

  // ì ìˆ˜ ê¸°ë¡ ì €ì¥
  const hist = loadScoreHistory();
  const modeStr = document.getElementById("modeDesc").textContent || "custom";
  hist.push({
    date: new Date().toLocaleString(),
    mode: modeStr,
    total: currentQuiz.length,
    correct,
    durationSec
  });
  saveScoreHistory(hist);
  renderScoreHistory();
}

// ========================
// 10. ì´ˆê¸°í™”
// ========================
function resetQuiz() {
  stopTimer();
  quizStarted = false;
  currentQuiz = [];
  document.getElementById("quizBox").innerHTML = "";
  document.getElementById("resultBox").innerHTML = "";
  document.getElementById("modeDesc").textContent = "";
  document.getElementById("timer").textContent = "Timer: OFF";
  document.getElementById("startBtn").disabled = false;
  document.getElementById("submitBtn").disabled = true;
  document.getElementById("resetBtn").disabled = true;
}

// ========================
// 11. ë¬¸ì œ ì¶”ê°€ í¼ (ìˆ˜ë™ 1ë¬¸ì œ)
// ========================
function setupAddQuestionForm() {
  const form = document.getElementById("addQuestionForm");
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const id = document.getElementById("addId").value.trim();
    const chapter = document.getElementById("addChapter").value;
    const type = document.getElementById("addType").value;
    const text = document.getElementById("addText").value.trim();
    const opA = document.getElementById("addOpA").value.trim();
    const opB = document.getElementById("addOpB").value.trim();
    const opC = document.getElementById("addOpC").value.trim();
    const opD = document.getElementById("addOpD").value.trim();
    const ans = Number(document.getElementById("addAnswer").value);
    const exp = document.getElementById("addExplanation").value.trim();

    if (!id || !text || !opA || !opB || !opC || !opD || isNaN(ans) || ans < 0 || ans > 3 || !exp) {
      alert("ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    const custom = loadCustomQuestions();
    if (custom.find(q => q.id === id) || BASE_QUESTIONS.find(q => q.id === id)) {
      alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” IDì…ë‹ˆë‹¤. ë‹¤ë¥¸ IDë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
      return;
    }

    custom.push({
      id,
      chapter,
      type,
      text,
      options: [opA, opB, opC, opD],
      answer: ans,
      explanation: exp
    });
    saveCustomQuestions(custom);
    alert("ë¬¸ì œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ìŒ ì¶œì œë¶€í„° í¬í•¨ë©ë‹ˆë‹¤.");

    form.reset();
    document.getElementById("addAnswer").value = 0;
  });
}

// ========================
// 11-1. ë¬¸ì œ íŒŒì¼ ì—…ë¡œë“œ (JSON ì—¬ëŸ¬ ê°œ)
// ========================
function setupUploadQuestions() {
  const input = document.getElementById("uploadFileInput");
  const btn = document.getElementById("uploadFileBtn");
  if (!input || !btn) return;

  btn.addEventListener("click", () => {
    const file = input.files && input.files[0];
    if (!file) {
      alert("ì—…ë¡œë“œí•  JSON íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const text = e.target.result;
        const parsed = JSON.parse(text);

        if (!Array.isArray(parsed)) {
          alert("JSON ìµœìƒìœ„ êµ¬ì¡°ê°€ ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆì‹œ íŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
          return;
        }

        const valid = [];
        parsed.forEach((q, idx) => {
          if (!q.id || !q.chapter || !q.type || !q.text ||
              !Array.isArray(q.options) || q.options.length !== 4 ||
              typeof q.answer !== "number" || q.answer < 0 || q.answer > 3 ||
              !q.explanation) {
            console.warn("í˜•ì‹ ì˜¤ë¥˜ë¡œ ì œì™¸ë¨:", idx, q);
          } else {
            valid.push(q);
          }
        });

        if (!valid.length) {
          alert("ì¶”ê°€ ê°€ëŠ¥í•œ ë¬¸ì œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
          return;
        }

        const custom = loadCustomQuestions();
        const allIds = new Set(
          BASE_QUESTIONS.map(q => q.id).concat(custom.map(q => q.id))
        );

        const filtered = valid.filter(q => {
          if (allIds.has(q.id)) {
            console.warn("ì¤‘ë³µ IDë¡œ ì œì™¸:", q.id);
            return false;
          }
          return true;
        });

        if (!filtered.length) {
          alert("ëª¨ë“  IDê°€ ê¸°ì¡´ ë¬¸ì œì™€ ì¤‘ë³µë˜ì–´ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        const newList = custom.concat(filtered);
        saveCustomQuestions(newList);

        alert(`íŒŒì¼ì—ì„œ ${filtered.length}ê°œì˜ ë¬¸ì œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        input.value = "";
      } catch (err) {
        console.error(err);
        alert("JSON íŒŒì‹± ì˜¤ë¥˜: íŒŒì¼ í˜•ì‹ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.");
      }
    };

    reader.readAsText(file, "utf-8");
  });
}

// ========================
// 11-2. ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œ ê´€ë¦¬ (ì´ˆê¸°í™” + Export)
// ========================
function setupCustomManagement() {
  const clearBtn = document.getElementById("clearCustomBtn");
  const exportBtn = document.getElementById("exportCustomBtn");

  if (clearBtn) {
    clearBtn.addEventListener("click", () => {
      if (!confirm("ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?\n(ê¸°ë³¸ ë¬¸ì œ, ì˜¤ë‹µ, ì ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤)")) return;
      saveCustomQuestions([]);
      alert("ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œê°€ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
    });
  }

  if (exportBtn) {
    exportBtn.addEventListener("click", () => {
      const custom = loadCustomQuestions();
      if (!custom.length) {
        alert("ì €ì¥ëœ ì‚¬ìš©ì ì¶”ê°€ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      const jsonStr = JSON.stringify(custom, null, 2);
      const blob = new Blob([jsonStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const dateStr = new Date().toISOString().slice(0,10); // YYYY-MM-DD
      a.href = url;
      a.download = `cre_custom_questions_${dateStr}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  }
}

// ========================
// 12. ë¹„ë°€ë²ˆí˜¸ ê²Œì´íŠ¸
// ========================
function setupGate() {
  const overlay = document.getElementById("gateOverlay");
  const pwInput = document.getElementById("gatePassword");
  const btn = document.getElementById("gateBtn");
  const msg = document.getElementById("gateMessage");
  const app = document.getElementById("appContainer");

  function tryEnter() {
    const val = pwInput.value || "";
    if (val === APP_PASSWORD) {
      overlay.style.display = "none";
      app.style.display = "block";
      renderWrongNotes();
      renderScoreHistory();
    } else {
      msg.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    }
  }

  btn.addEventListener("click", tryEnter);
  pwInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      tryEnter();
    }
  });
}

// ========================
// 13. ì´ˆê¸°í™”
// ========================
document.getElementById("startBtn").addEventListener("click", startQuiz);
document.getElementById("submitBtn").addEventListener("click", () => submitQuiz(false));
document.getElementById("resetBtn").addEventListener("click", resetQuiz);

setupAddQuestionForm();
setupUploadQuestions();
setupCustomManagement();
setupGate();
</script>
</body>
</html>
